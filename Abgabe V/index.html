<!DOCTYPE html>
<html>

<head>
    <title>Simple AR - A Web based AR for A-Frame</title>
    <script src="js/aframe-v1.5.0.min.js"></script>
</head>

<body>
    <script src="js/simple-ar.min.js" onload="onWasmLoaded();"></script>
    <a-scene>
        <a-entity simple-ar="src: assets/target2.png; minCutOffValue: 1; betaValue:0.1;">
            <a-entity id="snow"></a-entity>
        </a-entity>
        <a-camera position="0 0 0"></a-camera>
    </a-scene>

    
    <script>

        const targetObject = document.querySelector('#snow');


        for (let i = 0; i < 100; i++) {
            const plane = document.createElement('a-plane');
            const size = (Math.random() * .3 + 0.03).toFixed(2);

            const startX = (Math.random() - 0.5) * 8;
            const startY = Math.random() * 6 + 2;
            const startZ = (Math.random() - 0.5) * 8;

            const endY = -10;

            plane.setAttribute('width', size);
            plane.setAttribute('height', size);
            plane.setAttribute('position', `${startX} ${startY} ${startZ}`);
            plane.setAttribute('material', {
                src: 'assets/snowflake.png',
                alphaTest: 0.5
            });

            const duration = 4000 + Math.random() * 3000;

            plane.setAttribute('animation__fall', {
                property: 'position',
                from: `${startX} ${startY} ${startZ}`,
                to: `${startX} ${endY} ${startZ}`,
                dur: duration,
                easing: 'linear',
                loop: true
            });

            plane.addEventListener('animationloop', () => {
                const newX = (Math.random() - 0.5) * 8;
                const newY = Math.random() * 6 + 2;
                const newZ = (Math.random() - 0.5) * 8;

                plane.setAttribute('animation__fall', {
                    from: `${newX} ${newY} ${newZ}`,
                    to: `${newX} ${endY} ${newZ}`,
                    dur: 4000 + Math.random() * 3000
                });
            });

            targetObject.appendChild(plane);
        }
    </script>
</body>

</html>